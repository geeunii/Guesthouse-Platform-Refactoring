# ğŸ  ì§€ê¸ˆì´ê³³ - AI í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤ í”Œë«í¼ (Refactoring)

<div align="center">

![Project Status](https://img.shields.io/badge/status-completed-success?style=flat-square)
![Spring Boot](https://img.shields.io/badge/Spring_Boot-3.x-6DB33F?style=flat-square&logo=springboot)
![NCP](https://img.shields.io/badge/Naver_Cloud-Platform-03C75A?style=flat-square&logo=naver)
![Vue.js](https://img.shields.io/badge/Vue.js-3.x-4FC08D?style=flat-square&logo=vuedotjs)

**í”„ë¡œì íŠ¸ëª…:** ì§€ê¸ˆ ì´ê³³ | **í”„ë¡œì íŠ¸ ìœ í˜•:** K-Digital Training ìµœì¢… í”„ë¡œì íŠ¸

**í”„ë¡œì íŠ¸ ê¸°ê°„:** 2025.12.10 ~ 2026.01.15

**ë‹´ë‹¹ íŒŒíŠ¸:** í˜¸ìŠ¤íŠ¸ ê¸°ëŠ¥ ë° í˜ì´ì§€ & ê´€ë¦¬ì ê¸°ëŠ¥ ë° í˜ì´ì§€ & AI ë¶„ì„ ë¡œì§

</div>

---

## ğŸ“‘ ëª©ì°¨
- [í”„ë¡œì íŠ¸ ì†Œê°œ](#-í”„ë¡œì íŠ¸-ì†Œê°œ)
- [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
- [ë‚˜ì˜ ë‹´ë‹¹ ê¸°ëŠ¥](#-ë‚˜ì˜-ë‹´ë‹¹-ê¸°ëŠ¥)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#-ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜--ì¸í”„ë¼)
- [ê¸°ìˆ ì  ë„ì „ê³¼ í•´ê²°](#-ê¸°ìˆ ì -ë„ì „ê³¼-í•´ê²°)
- [íŠ¸ëŸ¬ë¸” ìŠˆíŒ… ë¡œê·¸](#-íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…-troubleshooting-log)
- [ì„œë¹„ìŠ¤ ì‹œì—°](#-ì„œë¹„ìŠ¤-ì‹œì—°)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#-í”„ë¡œì íŠ¸-êµ¬ì¡°)

---

## ğŸ¯ í”„ë¡œì íŠ¸ ì†Œê°œ

**"í˜¸ìŠ¤íŠ¸ê°€ ë“±ë¡í•œ ìˆ™ì†Œë„ AI ì»¨ì„¤íŒ…ì„ ë°›ì„ ìˆ˜ ìˆì„ê¹Œ?"** ë¼ëŠ” ê³ ë¯¼ì—ì„œ ì¶œë°œí–ˆìŠµë‹ˆë‹¤.  
ìƒì„±í˜• AI(Google Gemini)ë¥¼ í™œìš©í•´ ìˆ™ì†Œ ë¦¬ë·°, ë§¤ì¶œ, ìˆ˜ìš”ë¥¼ ë¶„ì„í•˜ê³  ìš´ì˜ ì†”ë£¨ì…˜ì„ ì œì•ˆí•˜ëŠ” **B2B í˜¸ìŠ¤íŠ¸ ê´€ë¦¬ í”Œë«í¼**ì…ë‹ˆë‹¤.  
ê¸°ì¡´ì˜ ëª¨ë†€ë¦¬ì‹ êµ¬ì¡°ë¥¼ ê°œì„ í•˜ì—¬, **NCP VPC í™˜ê²½ì—ì„œ User/Admin ì„œë²„ë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬**í•˜ê³  ë³´ì•ˆì„ ê°•í™”í•œ ë²„ì „ì…ë‹ˆë‹¤.

### ğŸ’¡ ê¸°íš ë°°ê²½
- ì‹ ê·œ í˜¸ìŠ¤íŠ¸ëŠ” ë¦¬ë·° ë°ì´í„°ê°€ ë¶€ì¡±í•˜ì—¬ ê°ê´€ì ì¸ ìˆ™ì†Œ ìƒíƒœ íŒŒì•…ì´ ì–´ë ¤ì›€
- íŠ¸ë˜í”½ì´ ëª°ë¦´ ê²½ìš°, ê´€ë¦¬ì ê¸°ëŠ¥(ì •ì‚° ë“±)ê¹Œì§€ ì˜í–¥ì„ ë°›ëŠ” êµ¬ì¡°ì  ë¬¸ì œ í•´ê²° í•„ìš”
- ë‹¨ìˆœ í†µê³„ë¥¼ ë„˜ì–´ì„ , AI ê¸°ë°˜ì˜ ì¸ì‚¬ì´íŠ¸ ì œê³µ ë‹ˆì¦ˆ ì¦ê°€

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### Backend
- **Framework:** Spring Boot 3.4
- **Language:** Java 17
- **Database:** MySQL 8.0, Redis (Session/Cache)
- **ORM:** JPA (Hibernate), QueryDSL

### Infra & DevOps
- **Cloud:** Naver Cloud Platform (VPC)
- **Server:** Ubuntu 20.04, Nginx (Reverse Proxy)
- **CI/CD:** GitHub Actions (Self-hosted Runner)
- **Container:** Docker, Docker Compose

### AI & External API
- **AI:** Google Gemini Pro API
- **API:** Toss Payments, Kakao Map, CoolSMS

---

## ğŸ’¼ ë‚˜ì˜ ë‹´ë‹¹ ê¸°ëŠ¥

### 1. ê´€ë¦¬ì ì„œë²„ ì¸í”„ë¼ êµ¬ì¶•
- **ê´€ë¦¬ì ì„œë²„ ê²©ë¦¬:** VPC í™˜ê²½ì˜ **Private Subnetì— ê´€ë¦¬ì ì„œë²„ë¥¼ ë°°ì¹˜**í•˜ì—¬ ì™¸ë¶€ ì§ì ‘ ì ‘ê·¼ ì°¨ë‹¨ ë° ë³´ì•ˆ ê°•í™”
- **ì„œë²„ ë¬¼ë¦¬ì  ë¶„ë¦¬:** `User API Server`ì™€ `Admin Server`ë¥¼ ë¶„ë¦¬ ìš´ì˜í•˜ì—¬ ì‚¬ìš©ì íŠ¸ë˜í”½ ê°„ì„­ ì œê±°
- **Air-gap ë°°í¬:** ì™¸ë¶€ ë§ì´ ì°¨ë‹¨ëœ Private ì„œë²„ì— ë°°í¬í•˜ê¸° ìœ„í•´ Public Serverë¥¼ ê²½ìœ í•˜ëŠ” íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

### 2. ğŸ¤– AI ë¦¬í¬íŠ¸ ë¡œì§ êµ¬í˜„ (Backend)
- **Gemini API ì—°ë™:** `RestTemplate`ì„ í™œìš©í•œ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ë° ì‘ë‹µ ì²˜ë¦¬
- **Cold Start í•´ê²°:** ë¦¬ë·° 5ê°œ ë¯¸ë§Œ ìˆ™ì†Œë¥¼ ìœ„í•œ 'íŠ¸ë Œë“œ ê¸°ë°˜ ì»¨ì„¤íŒ…' ëª¨ë“œ ê°œë°œ
- **ì•ˆì •ì„± í™•ë³´:** AI ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨ë¥¼ ë°©ì–´í•˜ëŠ” `parseSafe` ë¡œì§ êµ¬í˜„

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ & ì¸í”„ë¼
> **ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ VPC ë„¤íŠ¸ì›Œí¬ ë¶„ë¦¬ (Public / Private Zone)**

![System Architecture](./images/system.jpeg)

- **Reverse Proxy (Nginx):** Public Zoneì— ë°°ì¹˜í•˜ì—¬ ì™¸ë¶€ íŠ¸ë˜í”½ì„ ìˆ˜ì‹ í•˜ê³ , ë‚´ë¶€ Private Zoneì˜ ì„œë²„ë¡œ ë¼ìš°íŒ…
- **Security:** DBì™€ Redis, Admin ServerëŠ” ì™¸ë¶€ ì ‘ê·¼ì´ ì°¨ë‹¨ëœ Private Subnetì— ë°°ì¹˜

---

## ğŸ”¥ ê¸°ìˆ ì  ë„ì „ê³¼ í•´ê²°

### 1ï¸âƒ£ AI ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜ í•´ê²° ë° Cold Start ì „ëµ

#### âŒ ë¬¸ì œ ìƒí™©
- ì™¸ë¶€ AI API(Gemini)ê°€ ê°„í—ì ìœ¼ë¡œ JSON í˜•ì‹ì´ ì•„ë‹Œ ì¼ë°˜ í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•˜ì—¬ `JsonMappingException` ë°œìƒ.
- ë¦¬ë·°ê°€ 0ê°œì¸ ì‹ ê·œ ìˆ™ì†ŒëŠ” ë¶„ì„í•  ë°ì´í„°ê°€ ì—†ì–´ ì„œë¹„ìŠ¤ ì´ìš© ë¶ˆê°€.

#### âœ… í•´ê²° ë°©ë²•
1. **ë°©ì–´ì  íŒŒì‹± ë¡œì§(`parseSafe`) êµ¬í˜„:** ì‘ë‹µ ê°ì²´ë¥¼ `Object`ë¡œ ìœ ì—°í•˜ê²Œ ë°›ì€ ë’¤, `instanceof`ë¡œ íƒ€ì…ì„ ê²€ì‚¬í•˜ê³  ê°•ì œë¡œ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ì •ê·œí™”í•˜ì—¬ **íŒŒì‹± ì—ëŸ¬ìœ¨ 0%** ë‹¬ì„±.
2. **ì´ì›í™”ëœ í”„ë¡¬í”„íŠ¸ ì „ëµ:**
   - **Data Sufficient:** `Review Analysis Mode` (ë¦¬ë·° ê¸°ë°˜ ì¥ë‹¨ì  ë¶„ì„)
   - **Data Insufficient:** `Trend Consulting Mode` (ì§€ì—­/ì‹œì¦Œ íŠ¸ë Œë“œ ê¸°ë°˜ ì¡°ì–¸ ì œê³µ)

#### ğŸ“Š ê²°ê³¼
- ë¦¬ë·°ê°€ 0ê°œì¸ ìˆ™ì†Œë„ **100% ì •ë³´ ì œê³µ**ì´ ê°€ëŠ¥í•´ì ¸ ì´ˆê¸° ì‚¬ìš©ì ê²½í—˜(UX) ê°œì„ .

---

### 2ï¸âƒ£ ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ ê´€ë¦¬ì ì„œë²„ ë¶„ë¦¬ (Air-gap)

#### âŒ ë¬¸ì œ ìƒí™©
- ë‹¨ì¼ ì„œë²„ ìš´ì˜ ì‹œ, ì‚¬ìš©ì íŠ¸ë˜í”½ í­ì£¼ê°€ ê´€ë¦¬ì ê¸°ëŠ¥(ì •ì‚°/ìš´ì˜) ë§ˆë¹„ë¡œ ì´ì–´ì§ˆ ìœ„í—˜ ì¡´ì¬.
- ê´€ë¦¬ì í˜ì´ì§€ê°€ Public IPë¡œ ë…¸ì¶œë˜ì–´ ë³´ì•ˆ ì·¨ì•½ì  ë°œìƒ.

#### âœ… í•´ê²° ë°©ë²•
1. **ì„œë²„ ì•„í‚¤í…ì²˜ ë¶„ë¦¬:** `User Server`(Public)ì™€ `Admin Server`(Private)ë¡œ ë¬¼ë¦¬ì  ë¶„ë¦¬.
2. **íì‡„ë§ ë°°í¬ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•:** ì™¸ë¶€ ì¸í„°ë„·ì´ ì°¨ë‹¨ëœ Private Subnetì— ë°°í¬í•˜ê¸° ìœ„í•´, Public Serverë¥¼ ê²½ìœ (SCP)í•˜ì—¬ Docker ì´ë¯¸ì§€ë¥¼ ì „ì†¡í•˜ëŠ” Air-gap ë°©ì‹ ì ìš©.
3. **ACG(Firewall) ìµœì í™”:** ë‚´ë¶€ VPC ëŒ€ì—­(`10.0.X.X`)ê³¼ Nginx IPì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ Inbound ê·œì¹™ ì—„ê²© ì œì–´.

---

## ğŸš’ íŠ¸ëŸ¬ë¸” ìŠˆíŒ… (Troubleshooting Log)
> **í”„ë¡œì íŠ¸ ì§„í–‰ ì¤‘ ë°œìƒí•œ ì£¼ìš” ê¸°ìˆ ì  ì´ìŠˆì™€ í•´ê²° ê³¼ì •ì…ë‹ˆë‹¤. (í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸°)**

<details>
<summary>ğŸ‘‰ <b>1. Docker "Bind for 0.0.0.0:8080 failed" (ì¢€ë¹„ í¬íŠ¸ & í¬íŠ¸ ì¶©ëŒ)</b></summary>

**[ë¬¸ì œ ìƒí™©]**
- `docker run` ì‹œ 8080 í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë¼ëŠ” ì—ëŸ¬ ë°œìƒ.
- `netstat`ìœ¼ë¡œ í™•ì¸í•´ë„ ì ìœ  í”„ë¡œì„¸ìŠ¤ê°€ ë³´ì´ì§€ ì•ŠëŠ” 'Ghost Port' í˜„ìƒ.

**[í•´ê²° ê³¼ì •]**
- **ì†Œì¼“ ë° ëŸ°íƒ€ì„ ì¢…ë£Œ:** `systemctl stop docker.socket` í›„ `lsof`ë¡œ í”„ë¡œì„¸ìŠ¤ ì •ë¦¬.
- **í¬íŠ¸ ì „ëµ ìˆ˜ì •:** Admin Serverì˜ ì™¸ë¶€ í¬íŠ¸ë¥¼ `8081`ë¡œ ë³€ê²½í•˜ì—¬ ë°°í¬.

```bash
# ê¸°ì¡´ 8080 ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ Host Portë¥¼ 8081ë¡œ ë§¤í•‘í•˜ì—¬ ì‹¤í–‰
docker run -d \
  -p 8081:8080 \
  --name admin-server \
  --network vpc-network \
  admin-server:latest

```

**[ê²°ê³¼]**

* í¬íŠ¸ ì¶©ëŒ í•´ê²° ë° User/Admin ì»¨í…Œì´ë„ˆ ê³µì¡´ í™˜ê²½ êµ¬ì¶•.

</details>

<details>
<summary>ğŸ‘‰ <b>2. Nginx 502 Bad Gateway (Reverse Proxy ë¼ìš°íŒ… ì‹¤íŒ¨)</b></summary>

**[ë¬¸ì œ ìƒí™©]**

* ì„œë²„ ë¶„ë¦¬ í›„, ê´€ë¦¬ì í˜ì´ì§€ ì ‘ì† ì‹œ 502 ì—ëŸ¬ ë°œìƒ.
* Nginxê°€ Private Subnetì— ìˆëŠ” Admin Serverë¥¼ ì°¾ì§€ ëª»í•¨.

**[í•´ê²° ê³¼ì •]**

* **Upstream ì„¤ì • êµ¬ì²´í™”:** Nginx ì„¤ì •ì— `/api/admin/` ë¸”ë¡ì„ ì¶”ê°€í•˜ê³ , `localhost`ê°€ ì•„ë‹Œ **ì‹¤ì œ Private IP**ë¥¼ ëª…ì‹œ.

```nginx
# /etc/nginx/sites-available/default
location /api/admin/ {
    # localhost(X) -> Private IP(O) ëª…ì‹œì  ì§€ì •
    proxy_pass [http://10.0.2.8:8081](http://10.0.2.8:8081); 
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

```

**[ê²°ê³¼]**

* ë¸Œë¼ìš°ì €(Public) -> Nginx(Public) -> Admin Container(Private)ë¡œ ì´ì–´ì§€ëŠ” ë³´ì•ˆ ë¼ìš°íŒ… êµ¬ì¡° ì™„ì„±.

</details>

<details>
<summary>ğŸ‘‰ <b>3. AI ì‘ë‹µ ë¶ˆí™•ì‹¤ì„± ë° ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜ (ClassCastException)</b></summary>

**[ë¬¸ì œ ìƒí™©]**

* Gemini APIì—ê²Œ `List<String>` í˜•íƒœë¥¼ ìš”ì²­í–ˆìœ¼ë‚˜, ê°„í—ì ìœ¼ë¡œ ë‹¨ìˆœ `String`ì´ë‚˜ í¬ë§·ì´ ê¹¨ì§„ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ì—¬ 500 ì—ëŸ¬ ë°œìƒ.

**[í•´ê²° ê³¼ì •]**

* **ë°©ì–´ì  íŒŒì‹± ë¡œì§(`parseSafe`) êµ¬í˜„:** ì‘ë‹µì„ `Object`ë¡œ ë°›ì•„ íƒ€ì…ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬.

```java
// AIê°€ Stringìœ¼ë¡œ ì£¼ë“  Listë¡œ ì£¼ë“  ë¬´ì¡°ê±´ List<String>ìœ¼ë¡œ ë³€í™˜
private List<String> parseSafe(Object response) {
    if (response == null) return new ArrayList<>();
    
    // ë‹¨ìˆœ ë¬¸ìì—´ë¡œ ì˜¨ ê²½ìš° ì½¤ë§ˆ(,)ë¡œ ì˜ë¼ì„œ ë¦¬ìŠ¤íŠ¸í™”
    if (response instanceof String) {
        return Arrays.stream(((String) response).split(","))
                     .map(String::trim)
                     .collect(Collectors.toList());
    }
    
    // ì´ë¯¸ ë¦¬ìŠ¤íŠ¸ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ìºìŠ¤íŒ…
    return (List<String>) response;
}

```

**[ê²°ê³¼]**

* AI ì‘ë‹µ í˜•íƒœì™€ ë¬´ê´€í•˜ê²Œ íŒŒì‹± ì—ëŸ¬ìœ¨ **0%** ë‹¬ì„± ë° ì„œë¹„ìŠ¤ ì•ˆì •ì„± í™•ë³´.

</details>

---

## ğŸ’» ì„œë¹„ìŠ¤ ì‹œì—°

> **ë°ì´í„° ë¶€ì¡±(Cold Start) ì‹œì—ë„ AIê°€ ì§€ì—­ íŠ¸ë Œë“œë¥¼ ë¶„ì„í•˜ì—¬ ì»¨ì„¤íŒ…ì„ ì œê³µí•©ë‹ˆë‹¤.**

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°

```bash
src
â”œâ”€â”€ main
â”‚   â”œâ”€â”€ java/com/geharbang
â”‚   â”‚   â”œâ”€â”€ domain
â”‚   â”‚   â”‚   â”œâ”€â”€ host       # AI ë¦¬í¬íŠ¸ ìƒì„± ë¡œì§ (Prompt Engineering)
â”‚   â”‚   â”‚   â”œâ”€â”€ settlement # ì •ì‚° ë° ë§¤ì¶œ ê´€ë¦¬
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ global
â”‚   â”‚   â”‚   â”œâ”€â”€ config     # NCP Object Storage & Gemini Config
â”‚   â”‚   â”‚   â””â”€â”€ security   # Spring Security ì„¤ì •
...

```

---

## ğŸ“¬ Contact

**Email:** [koo4934@gmail.com](mailto:koo4934@gmail.com)

**Portfolio:** [https://geeunii.github.io](https://geeunii.github.io)
